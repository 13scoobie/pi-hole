#!/usr/bin/env python3
# Copyright (c) 2016 Jacob Salmela
# Pi-hole: a DNS based ad-blocker [https://www.pi-hole.net]
#
# Provide a command line interface for using Pi-hole
#
# The Pi-Hole is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.


# DOCOPT


"""Usage: pihole <command> [<args>...]

Commands:
    gravity     Starts up Pi-hole's ad-blocking gravity
    whitelist   Whitelist domain(s)
    blacklist   Blacklist domain(s)
    updateCore  Update Pi-hole Core
    updateWeb   Update Pi-hole Web Interface
    flush       Flush the DNS log
    debug       Generate a new debug log
    help        Show corresponding help
    uninstall   Uninstall Pi-hole ;(

See 'pihole help [command]' for more information on a specific command"""


# IMPORTS


import pihole_vars
import gravity
import list
import blacklist
import updateCore
import updateWeb
import flush
import debug
import uninstall
from docopt import docopt
import os


# SCRIPT


def main():
    # Check for root access
    if os.geteuid() != 0:
        print("This requires root access")
        exit()

    arguments = docopt(__doc__, version=pihole_vars.version, options_first=True)

    command = arguments['<command>']
    command_args = [command] + arguments["<args>"]

    if command == "gravity":
        gravity.main(command_args)
    elif command == "whitelist":
        list.main(command_args)
    elif command == "blacklist":
        blacklist.main(command_args)
    elif command == "updateCore":
        updateCore.main(command_args)
    elif command == "updateWeb":
        updateWeb.main(command_args)
    elif command == "flush":
        flush.main(command_args)
    elif command == "debug":
        debug.main(command_args)
    elif command == "uninstall":
        uninstall.main(command_args)
    elif command == "help":
        if len(command_args) == 1:
            print(__doc__)
            exit()
        elif len(command_args) != 2:
            print("Please enter only one command to find help on")
            exit()

        help_arg = arguments["<args>"][0]
        if help_arg == "gravity":
            print(gravity.__doc__)
        elif help_arg == "whitelist":
            print(list.__doc__)
        elif help_arg == "blacklist":
            print(blacklist.__doc__)
        elif help_arg == "updateCore":
            print(updateCore.__doc__)
        elif help_arg == "updateWeb":
            print(updateWeb.__doc__)
        elif help_arg == "flush":
            print(flush.__doc__)
        elif help_arg == "debug":
            print(debug.__doc__)
        elif help_arg == "uninstall":
            print(uninstall.__doc__)
        else:
            print('Could not find help for "' + help_arg + '"')
    else:
        print("Unknown command")

if __name__ == "__main__":
    main()
